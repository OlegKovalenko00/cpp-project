openapi: 3.0.3
info:
  title: MetricSys API
  version: 1.0.0
  description: API for receiving frontend analytics events.

servers:
  - url: http://localhost:8080

paths:
  /health/ping:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Returns service health status
      operationId: healthPing
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "ok"
        '500':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INTERNAL_ERROR"
                message: "Service unavailable"


  /page-views:
    post:
      tags:
        - Events
      summary: Send page view event
      operationId: createPageView
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PageViewEvent'
            example:
              page: "/home"
              user_id: "user_123"
              session_id: "sess_456"
              referrer: "https://google.com/search?q=metrics"
              timestamp: 1733505600
      responses:
        '202':
          description: Page view accepted
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INVALID_PAGE_VIEW"
                message: "Field 'page' must not be empty"
                details:
                  field: "page"
                  reason: "required"

  /clicks:
    post:
      tags:
        - Events
      summary: Send click/UI event
      operationId: createClick
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClickEvent'
            example:
              page: "/pricing"
              element_id: "cta-subscribe-button"
              action: "click"
              user_id: "user_123"
              session_id: "sess_456"
              timestamp: 1733505605
      responses:
        '202':
          description: Click event accepted
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INVALID_CLICK_EVENT"
                message: "Field 'element_id' must not be empty"
                details:
                  field: "element_id"
                  reason: "required"

  /performance:
    post:
      tags:
        - Events
      summary: Send frontend performance metrics
      operationId: createPerformance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PerformanceEvent'
            example:
              page: "/dashboard"
              ttfb_ms: 120
              fcp_ms: 450
              lcp_ms: 820
              total_page_load_ms: 1150
              user_id: "user_123"
              session_id: "sess_456"
              timestamp: 1733505610
      responses:
        '202':
          description: Performance metrics accepted
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INVALID_PERFORMANCE_EVENT"
                message: "Timing fields must be non-negative"
                details:
                  field: "ttfb_ms"
                  reason: "must_be_positive"

  /errors:
    post:
      tags:
        - Events
      summary: Send frontend error event
      operationId: createErrorEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorEvent'
            example:
              page: "/dashboard"
              error_type: "js_exception"
              message: "Cannot read properties of undefined (reading 'id')"
              stack: "TypeError: Cannot read properties of undefined...\n    at Dashboard.tsx:42:15"
              severity: "error"
              user_id: "user_123"
              session_id: "sess_456"
              timestamp: 1733505615
      responses:
        '202':
          description: Error event accepted
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INVALID_ERROR_EVENT"
                message: "Severity must be one of: warning, error, critical"
                details:
                  field: "severity"
                  reason: "invalid_enum_value"

  /custom-events:
    post:
      tags:
        - Events
      summary: Send custom application event
      operationId: createCustomEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomEvent'
            example:
              name: "signup_completed"
              page: "/signup/success"
              user_id: "user_123"
              session_id: "sess_456"
              properties:
                plan: "pro"
                source: "landing_a"
                ab_test_group: "B"
              timestamp: 1733505620
      responses:
        '202':
          description: Custom event accepted
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INVALID_CUSTOM_EVENT"
                message: "Field 'name' must not be empty"
                details:
                  field: "name"
                  reason: "required"

  /uptime:
    get:
      tags:
        - Monitoring
      summary: Get uptime stats for a service
      description: Returns uptime percentages for day/week/month/year or a specific period.
      operationId: getUptime
      parameters:
        - in: query
          name: service
          required: true
          schema:
            type: string
          description: Service name to query (e.g. api-service)
        - in: query
          name: period
          required: false
          schema:
            type: string
            enum: [day, week, month, year]
          description: Optional period filter; when omitted returns all periods.
      responses:
        '200':
          description: Uptime statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UptimeResponse'
        '400':
          description: Missing service or invalid period
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '500':
          description: Failed to read stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  details:
                    type: string

  /uptime/day:
    get:
      tags:
        - Monitoring
      summary: Get day uptime stats for a service
      operationId: getUptimeDay
      parameters:
        - in: query
          name: service
          required: true
          schema:
            type: string
          description: Service name to query
      responses:
        '200':
          description: Day uptime statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UptimeResponse'
        '400':
          description: Missing service
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  /uptime/week:
    get:
      tags:
        - Monitoring
      summary: Get week uptime stats for a service
      operationId: getUptimeWeek
      parameters:
        - in: query
          name: service
          required: true
          schema:
            type: string
          description: Service name to query
      responses:
        '200':
          description: Week uptime statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UptimeResponse'
        '400':
          description: Missing service
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  /uptime/month:
    get:
      tags:
        - Monitoring
      summary: Get month uptime stats for a service
      operationId: getUptimeMonth
      parameters:
        - in: query
          name: service
          required: true
          schema:
            type: string
          description: Service name to query
      responses:
        '200':
          description: Month uptime statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UptimeResponse'
        '400':
          description: Missing service
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  /uptime/year:
    get:
      tags:
        - Monitoring
      summary: Get year uptime stats for a service
      operationId: getUptimeYear
      parameters:
        - in: query
          name: service
          required: true
          schema:
            type: string
          description: Service name to query
      responses:
        '200':
          description: Year uptime statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UptimeResponse'
        '400':
          description: Missing service
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  /aggregation/watermark:
    get:
      tags:
        - Aggregation
      summary: Get aggregation watermark
      operationId: getAggregationWatermark
      responses:
        '200':
          description: Timestamp of the latest completed aggregation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetWatermarkResponse'
              example:
                last_aggregated_at: "2024-12-06T10:05:00Z"
        '500':
          description: Aggregation service is unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INTERNAL_ERROR"
                message: "Aggregation service unavailable"

  /aggregation/page-views:
    post:
      tags:
        - Aggregation
      summary: Get aggregated page view metrics
      operationId: getPageViewsAggregation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetPageViewsAggRequest'
            example:
              project_id: "proj_123"
              time_range:
                from: "2024-12-06T09:00:00Z"
                to: "2024-12-06T10:00:00Z"
              page: "/dashboard"
              pagination:
                limit: 100
                offset: 0
      responses:
        '200':
          description: Aggregated page view buckets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetPageViewsAggResponse'
              example:
                rows:
                  - time_bucket: "2024-12-06T10:00:00Z"
                    project_id: "proj_123"
                    page: "/dashboard"
                    views_count: 2400
                    unique_users: 350
                    unique_sessions: 420
                    created_at: "2024-12-06T10:05:00Z"
        '400':
          description: Invalid aggregation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "VALIDATION_ERROR"
                message: "time_range.to must be after time_range.from"
        '500':
          description: Aggregation service error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INTERNAL_ERROR"
                message: "Failed to fetch aggregation results"

  /aggregation/clicks:
    post:
      tags:
        - Aggregation
      summary: Get aggregated click metrics
      operationId: getClicksAggregation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetClicksAggRequest'
            example:
              project_id: "proj_123"
              time_range:
                from: "2024-12-06T09:00:00Z"
                to: "2024-12-06T10:00:00Z"
              page: "/pricing"
              element_id: "cta-subscribe-button"
              pagination:
                limit: 100
                offset: 0
      responses:
        '200':
          description: Aggregated click buckets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetClicksAggResponse'
              example:
                rows:
                  - time_bucket: "2024-12-06T10:00:00Z"
                    project_id: "proj_123"
                    page: "/pricing"
                    element_id: "cta-subscribe-button"
                    clicks_count: 180
                    unique_users: 120
                    unique_sessions: 140
                    created_at: "2024-12-06T10:05:00Z"
        '400':
          description: Invalid aggregation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "VALIDATION_ERROR"
                message: "project_id is required"
        '500':
          description: Aggregation service error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INTERNAL_ERROR"
                message: "Failed to fetch aggregation results"

  /aggregation/performance:
    post:
      tags:
        - Aggregation
      summary: Get aggregated performance metrics
      operationId: getPerformanceAggregation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetPerformanceAggRequest'
            example:
              project_id: "proj_123"
              time_range:
                from: "2024-12-06T09:00:00Z"
                to: "2024-12-06T10:00:00Z"
              page: "/dashboard"
              pagination:
                limit: 100
                offset: 0
      responses:
        '200':
          description: Aggregated performance buckets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetPerformanceAggResponse'
              example:
                rows:
                  - time_bucket: "2024-12-06T10:00:00Z"
                    project_id: "proj_123"
                    page: "/dashboard"
                    samples_count: 500
                    avg_total_load_ms: 1100
                    p95_total_load_ms: 1500
                    avg_ttfb_ms: 120
                    p95_ttfb_ms: 200
                    avg_fcp_ms: 450
                    p95_fcp_ms: 600
                    avg_lcp_ms: 900
                    p95_lcp_ms: 1250
                    created_at: "2024-12-06T10:05:00Z"
        '400':
          description: Invalid aggregation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "VALIDATION_ERROR"
                message: "project_id is required"
        '500':
          description: Aggregation service error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INTERNAL_ERROR"
                message: "Failed to fetch aggregation results"

  /aggregation/errors:
    post:
      tags:
        - Aggregation
      summary: Get aggregated error metrics
      operationId: getErrorsAggregation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetErrorsAggRequest'
            example:
              project_id: "proj_123"
              time_range:
                from: "2024-12-06T09:00:00Z"
                to: "2024-12-06T10:00:00Z"
              page: "/dashboard"
              error_type: "js_exception"
              pagination:
                limit: 100
                offset: 0
      responses:
        '200':
          description: Aggregated error buckets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetErrorsAggResponse'
              example:
                rows:
                  - time_bucket: "2024-12-06T10:00:00Z"
                    project_id: "proj_123"
                    page: "/dashboard"
                    error_type: "js_exception"
                    errors_count: 45
                    warning_count: 12
                    critical_count: 8
                    unique_users: 30
                    created_at: "2024-12-06T10:05:00Z"
        '400':
          description: Invalid aggregation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "VALIDATION_ERROR"
                message: "project_id is required"
        '500':
          description: Aggregation service error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INTERNAL_ERROR"
                message: "Failed to fetch aggregation results"

  /aggregation/custom-events:
    post:
      tags:
        - Aggregation
      summary: Get aggregated custom event metrics
      operationId: getCustomEventsAggregation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCustomEventsAggRequest'
            example:
              project_id: "proj_123"
              time_range:
                from: "2024-12-06T09:00:00Z"
                to: "2024-12-06T10:00:00Z"
              event_name: "signup_completed"
              page: "/signup/success"
              pagination:
                limit: 100
                offset: 0
      responses:
        '200':
          description: Aggregated custom event buckets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetCustomEventsAggResponse'
              example:
                rows:
                  - time_bucket: "2024-12-06T10:00:00Z"
                    project_id: "proj_123"
                    event_name: "signup_completed"
                    page: "/signup/success"
                    events_count: 75
                    unique_users: 60
                    unique_sessions: 65
                    created_at: "2024-12-06T10:05:00Z"
        '400':
          description: Invalid aggregation request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "VALIDATION_ERROR"
                message: "event_name is required"
        '500':
          description: Aggregation service error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "INTERNAL_ERROR"
                message: "Failed to fetch aggregation results"

components:
  schemas:
    HealthResponse:
      type: object
      required: [status]
      properties:
        status:
          type: string
          description: Health status
          example: "ok"

    ErrorResponse:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          description: Machine-readable error code
          enum:
            - INVALID_PAGE_VIEW
            - INVALID_CLICK_EVENT
            - INVALID_PERFORMANCE_EVENT
            - INVALID_ERROR_EVENT
            - INVALID_CUSTOM_EVENT
            - INVALID_BATCH
            - VALIDATION_ERROR
            - INTERNAL_ERROR
          example: "VALIDATION_ERROR"

        message:
          type: string
          description: Human-readable error description
          example: "Field 'page' must not be empty"

        details:
          type: object
          nullable: true
          description: Optional structured details about the error
          additionalProperties: true
          example:
            field: "page"
            reason: "required"

    UptimePeriodStat:
      type: object
      required: [ok, total, percent]
      properties:
        ok:
          type: integer
          format: int64
          description: Successful checks
          example: 95
        total:
          type: integer
          format: int64
          description: Total checks
          example: 100
        percent:
          type: number
          format: double
          description: Uptime percentage for the period
          example: 95.0

    UptimePeriods:
      type: object
      properties:
        day:
          $ref: '#/components/schemas/UptimePeriodStat'
        week:
          $ref: '#/components/schemas/UptimePeriodStat'
        month:
          $ref: '#/components/schemas/UptimePeriodStat'
        year:
          $ref: '#/components/schemas/UptimePeriodStat'

    UptimeResponse:
      type: object
      required: [service, period, periods]
      properties:
        service:
          type: string
          description: Service name
          example: "metrics-service"
        period:
          type: string
          description: Requested period or "all" when not filtered
          example: "day"
        periods:
          $ref: '#/components/schemas/UptimePeriods'
            
    PageViewEvent:
      type: object
      required: [page, timestamp]
      properties:
        page:
          type: string
          example: "/home"
        user_id:
          type: string
          nullable: true
          example: "user_123"
        session_id:
          type: string
          nullable: true
          example: "sess_456"
        referrer:
          type: string
          nullable: true
          example: "https://google.com/search?q=metrics"
        timestamp:
          type: integer
          format: int64
          example: 1733505600

    ClickEvent:
      type: object
      required: [page, element_id, timestamp]
      properties:
        page:
          type: string
          example: "/pricing"
        element_id:
          type: string
          example: "cta-subscribe-button"
        action:
          type: string
          example: "click"
        user_id:
          type: string
          nullable: true
          example: "user_123"
        session_id:
          type: string
          nullable: true
          example: "sess_456"
        timestamp:
          type: integer
          format: int64
          example: 1733505605

    PerformanceEvent:
      type: object
      required: [page, timestamp]
      properties:
        page:
          type: string
          example: "/dashboard"
        ttfb_ms:
          type: number
          example: 120
        fcp_ms:
          type: number
          example: 450
        lcp_ms:
          type: number
          example: 800
        total_page_load_ms:
          type: number
          example: 1100
        user_id:
          type: string
          nullable: true
          example: "user_123"
        session_id:
          type: string
          nullable: true
          example: "sess_456"
        timestamp:
          type: integer
          format: int64
          example: 1733505610

    ErrorEvent:
      type: object
      required: [page, error_type, message, timestamp]
      properties:
        page:
          type: string
          example: "/dashboard"
        error_type:
          type: string
          example: "js_exception"
        message:
          type: string
          example: "Cannot read properties of undefined (reading 'id')"
        stack:
          type: string
          nullable: true
          example: "TypeError: Cannot read properties of undefined...\n    at Dashboard.tsx:42:15"
        severity:
          type: string
          enum: ["warning", "error", "critical"]
          default: "error"
          example: "error"
        user_id:
          type: string
          nullable: true
          example: "user_123"
        session_id:
          type: string
          nullable: true
          example: "sess_456"
        timestamp:
          type: integer
          format: int64
          example: 1733505615

    CustomEvent:
      type: object
      required: [name, timestamp]
      properties:
        name:
          type: string
          example: "signup_completed"
        page:
          type: string
          nullable: true
          example: "/signup/success"
        user_id:
          type: string
          nullable: true
          example: "user_123"
        session_id:
          type: string
          nullable: true
          example: "sess_456"
        properties:
          type: object
          additionalProperties: true
          example:
            plan: "pro"
            source: "landing_a"
            ab_test_group: "B"
        timestamp:
          type: integer
          format: int64
          example: 1733505620

    TimeRange:
      type: object
      required: [from, to]
      properties:
        from:
          type: string
          format: date-time
          description: Start of the range (inclusive)
          example: "2024-12-06T09:00:00Z"
        to:
          type: string
          format: date-time
          description: End of the range (exclusive)
          example: "2024-12-06T10:00:00Z"

    Pagination:
      type: object
      properties:
        limit:
          type: integer
          format: int32
          minimum: 0
          description: Max rows to return
          example: 100
        offset:
          type: integer
          format: int32
          minimum: 0
          description: Offset for paging
          example: 0

    GetWatermarkResponse:
      type: object
      required: [last_aggregated_at]
      properties:
        last_aggregated_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp of the most recent aggregation pass
          example: "2024-12-06T10:05:00Z"

    AggPageViewsRow:
      type: object
      required:
        [time_bucket, project_id, page, views_count, unique_users, unique_sessions, created_at]
      properties:
        time_bucket:
          type: string
          format: date-time
          description: Start time of the aggregated bucket
          example: "2024-12-06T10:00:00Z"
        project_id:
          type: string
          example: "proj_123"
        page:
          type: string
          example: "/dashboard"
        views_count:
          type: integer
          format: int64
          example: 2400
        unique_users:
          type: integer
          format: int64
          example: 350
        unique_sessions:
          type: integer
          format: int64
          example: 420
        created_at:
          type: string
          format: date-time
          description: When this aggregate row was created
          example: "2024-12-06T10:05:00Z"

    AggClicksRow:
      type: object
      required:
        [time_bucket, project_id, page, clicks_count, unique_users, unique_sessions, created_at]
      properties:
        time_bucket:
          type: string
          format: date-time
          description: Start time of the aggregated bucket
          example: "2024-12-06T10:00:00Z"
        project_id:
          type: string
          example: "proj_123"
        page:
          type: string
          example: "/pricing"
        element_id:
          type: string
          nullable: true
          example: "cta-subscribe-button"
        clicks_count:
          type: integer
          format: int64
          example: 180
        unique_users:
          type: integer
          format: int64
          example: 120
        unique_sessions:
          type: integer
          format: int64
          example: 140
        created_at:
          type: string
          format: date-time
          description: When this aggregate row was created
          example: "2024-12-06T10:05:00Z"

    AggPerformanceRow:
      type: object
      required:
        [time_bucket, project_id, page, samples_count, avg_total_load_ms, p95_total_load_ms, avg_ttfb_ms, p95_ttfb_ms, avg_fcp_ms, p95_fcp_ms, avg_lcp_ms, p95_lcp_ms, created_at]
      properties:
        time_bucket:
          type: string
          format: date-time
          description: Start time of the aggregated bucket
          example: "2024-12-06T10:00:00Z"
        project_id:
          type: string
          example: "proj_123"
        page:
          type: string
          example: "/dashboard"
        samples_count:
          type: integer
          format: int64
          example: 500
        avg_total_load_ms:
          type: number
          format: double
          example: 1100
        p95_total_load_ms:
          type: number
          format: double
          example: 1500
        avg_ttfb_ms:
          type: number
          format: double
          example: 120
        p95_ttfb_ms:
          type: number
          format: double
          example: 200
        avg_fcp_ms:
          type: number
          format: double
          example: 450
        p95_fcp_ms:
          type: number
          format: double
          example: 600
        avg_lcp_ms:
          type: number
          format: double
          example: 900
        p95_lcp_ms:
          type: number
          format: double
          example: 1250
        created_at:
          type: string
          format: date-time
          description: When this aggregate row was created
          example: "2024-12-06T10:05:00Z"

    AggErrorsRow:
      type: object
      required:
        [time_bucket, project_id, page, errors_count, warning_count, critical_count, unique_users, created_at]
      properties:
        time_bucket:
          type: string
          format: date-time
          description: Start time of the aggregated bucket
          example: "2024-12-06T10:00:00Z"
        project_id:
          type: string
          example: "proj_123"
        page:
          type: string
          example: "/dashboard"
        error_type:
          type: string
          nullable: true
          example: "js_exception"
        errors_count:
          type: integer
          format: int64
          example: 45
        warning_count:
          type: integer
          format: int64
          example: 12
        critical_count:
          type: integer
          format: int64
          example: 8
        unique_users:
          type: integer
          format: int64
          example: 30
        created_at:
          type: string
          format: date-time
          description: When this aggregate row was created
          example: "2024-12-06T10:05:00Z"

    AggCustomEventsRow:
      type: object
      required:
        [time_bucket, project_id, event_name, events_count, unique_users, unique_sessions, created_at]
      properties:
        time_bucket:
          type: string
          format: date-time
          description: Start time of the aggregated bucket
          example: "2024-12-06T10:00:00Z"
        project_id:
          type: string
          example: "proj_123"
        event_name:
          type: string
          example: "signup_completed"
        page:
          type: string
          nullable: true
          example: "/signup/success"
        events_count:
          type: integer
          format: int64
          example: 75
        unique_users:
          type: integer
          format: int64
          example: 60
        unique_sessions:
          type: integer
          format: int64
          example: 65
        created_at:
          type: string
          format: date-time
          description: When this aggregate row was created
          example: "2024-12-06T10:05:00Z"

    GetPageViewsAggRequest:
      type: object
      required: [project_id, time_range]
      properties:
        project_id:
          type: string
          example: "proj_123"
        time_range:
          $ref: '#/components/schemas/TimeRange'
        page:
          type: string
          nullable: true
          example: "/dashboard"
        pagination:
          $ref: '#/components/schemas/Pagination'

    GetPageViewsAggResponse:
      type: object
      required: [rows]
      properties:
        rows:
          type: array
          items:
            $ref: '#/components/schemas/AggPageViewsRow'

    GetClicksAggRequest:
      type: object
      required: [project_id, time_range]
      properties:
        project_id:
          type: string
          example: "proj_123"
        time_range:
          $ref: '#/components/schemas/TimeRange'
        page:
          type: string
          nullable: true
          example: "/pricing"
        element_id:
          type: string
          nullable: true
          example: "cta-subscribe-button"
        pagination:
          $ref: '#/components/schemas/Pagination'

    GetClicksAggResponse:
      type: object
      required: [rows]
      properties:
        rows:
          type: array
          items:
            $ref: '#/components/schemas/AggClicksRow'

    GetPerformanceAggRequest:
      type: object
      required: [project_id, time_range]
      properties:
        project_id:
          type: string
          example: "proj_123"
        time_range:
          $ref: '#/components/schemas/TimeRange'
        page:
          type: string
          nullable: true
          example: "/dashboard"
        pagination:
          $ref: '#/components/schemas/Pagination'

    GetPerformanceAggResponse:
      type: object
      required: [rows]
      properties:
        rows:
          type: array
          items:
            $ref: '#/components/schemas/AggPerformanceRow'

    GetErrorsAggRequest:
      type: object
      required: [project_id, time_range]
      properties:
        project_id:
          type: string
          example: "proj_123"
        time_range:
          $ref: '#/components/schemas/TimeRange'
        page:
          type: string
          nullable: true
          example: "/dashboard"
        error_type:
          type: string
          nullable: true
          example: "js_exception"
        pagination:
          $ref: '#/components/schemas/Pagination'

    GetErrorsAggResponse:
      type: object
      required: [rows]
      properties:
        rows:
          type: array
          items:
            $ref: '#/components/schemas/AggErrorsRow'

    GetCustomEventsAggRequest:
      type: object
      required: [project_id, time_range, event_name]
      properties:
        project_id:
          type: string
          example: "proj_123"
        time_range:
          $ref: '#/components/schemas/TimeRange'
        event_name:
          type: string
          example: "signup_completed"
        page:
          type: string
          nullable: true
          example: "/signup/success"
        pagination:
          $ref: '#/components/schemas/Pagination'

    GetCustomEventsAggResponse:
      type: object
      required: [rows]
      properties:
        rows:
          type: array
          items:
            $ref: '#/components/schemas/AggCustomEventsRow'
