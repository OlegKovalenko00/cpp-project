#!/bin/bash

# Тестовый запуск aggregation-service с демонстрацией новых возможностей

set -e

cd "$(dirname "$0")/.."

echo "==================================="
echo "Тест: Периодический запуск и Graceful Shutdown"
echo "==================================="
echo ""

# Устанавливаем короткий интервал для демонстрации
export AGGREGATION_INTERVAL_SEC=5

echo "1. Запуск сервиса с интервалом агрегации 5 секунд..."
echo "   (Нажмите Ctrl+C через ~15 секунд для демонстрации graceful shutdown)"
echo ""

# Запускаем сервис
timeout 15 build/aggregation-service || true

echo ""
echo "==================================="
echo "Демонстрация завершена!"
echo ""
echo "Что мы увидели:"
echo "  ✓ Сервис запустился и показал интервал агрегации"
echo "  ✓ Периодически выполнялась агрегация (каждые 5 сек)"
echo "  ✓ Graceful shutdown при получении сигнала"
echo "  ✓ Обработка ошибок не прерывала работу"
echo "==================================="

