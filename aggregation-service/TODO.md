# TODO - Aggregation Service

## Высокий приоритет

### Оптимизация производительности
- [ ] Батчевая запись в БД (использовать `COPY` вместо множественных INSERT)
- [ ] Пулл соединений к PostgreSQL для параллельной записи
- [ ] Кеширование watermark в памяти для уменьшения запросов к БД
- [ ] Оптимизация gRPC запросов - использовать streaming вместо batch

### Улучшение надежности
- [ ] Реализовать retry логику для gRPC соединения с metrics-service
- [ ] Добавить circuit breaker для предотвращения каскадных сбоев
- [ ] Реализовать backoff стратегию при ошибках агрегации
- [ ] Добавить healthcheck для gRPC соединения с metrics-service

### Мониторинг и метрики
- [ ] Добавить Prometheus метрики:
  - Время выполнения агрегации
  - Количество обработанных событий
  - Количество ошибок
  - Размер watermark lag
- [ ] Экспорт метрик через `/metrics` endpoint
- [ ] Structured logging (JSON формат) для ELK stack

## Средний приоритет

### Конфигурация
- [ ] Загрузка конфигурации из файла (YAML/JSON) вместо только env переменных
- [ ] Валидация параметров конфигурации при старте
- [ ] Hot-reload конфигурации без перезапуска сервиса

### Агрегация
- [ ] Поддержка разных размеров bucket (1 минута, 5 минут, 1 час, 1 день)
- [ ] Параллельная агрегация для разных типов событий
- [ ] Поддержка late arriving events (события с задержкой)
- [ ] Вычисление дополнительных статистик:
  - Медиана, квартили для performance метрик
  - P50, P75, P99 percentiles
  - Min/Max значения

### База данных
- [ ] Миграции БД через отдельный инструмент (Flyway/Liquibase аналог для C++)
- [ ] Автоматическое партиционирование таблиц по времени
- [ ] Очистка старых данных (retention policy)
- [ ] Индексы для оптимизации запросов

### Тестирование
- [ ] Нагрузочные тесты (стресс-тестирование агрегации)
- [ ] Интеграционные тесты с реальным PostgreSQL
- [ ] Тесты производительности (benchmarks)
- [ ] Тесты отказоустойчивости (chaos engineering)

## Низкий приоритет

### Документация
- [ ] OpenAPI/Swagger документация для HTTP endpoints
- [ ] Диаграммы архитектуры (sequence diagrams, component diagrams)
- [ ] Примеры использования API
- [ ] Документация по troubleshooting

### DevOps
- [ ] Kubernetes манифесты (Deployment, Service, ConfigMap)
- [ ] Helm chart для удобного деплоя
- [ ] CI/CD pipeline (автоматическая сборка и тесты)
- [ ] Автоматический Docker build и push в registry

### Фичи
- [ ] REST API для запроса агрегированных данных
- [ ] WebSocket для real-time обновлений
- [ ] Поддержка multiple metrics-service инстансов (load balancing)
- [ ] Экспорт агрегированных данных в различные форматы (CSV, Parquet)

### Безопасность
- [ ] Аутентификация gRPC соединений (mTLS)
- [ ] Шифрование чувствительных данных в БД
- [ ] Rate limiting для HTTP endpoints
- [ ] Audit logging для критических операций

## Завершенные задачи

- [x] Базовая структура проекта
- [x] Подключение к PostgreSQL
- [x] Схема БД (5 таблиц + watermark)
- [x] Модель данных (структуры для событий и агрегатов)
- [x] gRPC клиент к metrics-service
- [x] Логика агрегации в памяти
- [x] Запись агрегированных данных в БД
- [x] Watermark механизм
- [x] Периодический запуск агрегации по таймеру
- [x] Graceful shutdown
- [x] Обработка ошибок с try-catch
- [x] HTTP endpoints для health checks
- [x] Dockerfile + docker-compose
- [x] Базовые unit тесты
- [x] Документация (README.md)

---

## Примечания

### Приоритизация
- **Высокий**: критично для production готовности
- **Средний**: желательно для улучшения качества
- **Низкий**: nice-to-have фичи

### Участие
Если вы хотите взяться за любую из этих задач, создайте issue с описанием вашего подхода.

